# Микросервис "Transaction Service" (дипломный проект)

**Тема дипломной работы:** Разработка программного комплекса для мониторинга и анализа производительности распределенной информационной системы предприятия.

Данный репозиторий содержит исходный код микросервиса `transaction-service`, который является ключевым компонентом демонстрационной распределенной системы. Сервис разработан в соответствии с современными инженерными практиками для создания надежных, масштабируемых и отказоустойчивых корпоративных приложений.

В рамках дипломного проекта данный сервис выступает в роли **объекта мониторинга** для основного программного комплекса.

**Связанные компоненты проекта:**
*   **Основной проект:** [observability-core-project](https://github.com/your-username/observability-core-project) (система мониторинга и анализа производительности)
*   **Frontend-приложение:** [frontend-repo](https://github.com/your-username/frontend-repo) (пользовательский интерфейс системы мониторинга)
*   **Инфраструктура:** [deployment-repo](https://github.com/your-username/deployment-repo) (конфигурация развертывания, включая Docker Compose и API Gateway)

---

## 1. Архитектура

### 1.1. Архитектура микросервиса (многомодульный проект)

Сервис спроектирован с использованием многомодульной архитектуры для строгого соблюдения принципа разделения ответственности (Separation of Concerns) и обеспечения слабой связанности между логическими слоями.

```
+----------------+      +----------------+
|  persistence   |      |      api       |  (Слой реализации)
+----------------+      +----------------+
         |                     |
         +--------+------------+
                  |
                  v
            +----------------+
            |     domain     |              (Слой бизнес-логики)
            +----------------+
                  |
                  v
            +----------------+
            |   public-api   |              (Слой публичных контрактов)
            +----------------+
```

*   **`public-api`:** Легковесный JAR-артефакт, содержащий только DTO (Data Transfer Objects) и `enum`. Определяет публичный, переиспользуемый контракт сервиса.
*   **`domain`:** "Чистая" бизнес-логика и модели предметной области. Этот модуль не зависит от фреймворков и деталей реализации (веб, БД).
*   **`persistence`:** Реализация слоя доступа к данным с использованием Spring Data JPA.
*   **`api`:** Реализация REST-контроллеров (публичных и внутренних).
*   **`app`:** Исполняемый модуль, который агрегирует все остальные модули и содержит основную конфигурацию приложения.
*   **`transaction-service-spring-boot-starter`:** (Опционально) Spring Boot стартер с преднастроенным Feign-клиентом для упрощения межсервисного взаимодействия.

### 1.2. Архитектура развертывания

Система разворачивается как набор Docker-контейнеров под управлением Docker Compose. Внешний доступ к микросервисам, включая этот, осуществляется исключительно через API Gateway (Kong), который обеспечивает централизованное управление безопасностью и маршрутизацией.

---

## 2. Ключевые технические решения и реализованные паттерны

В данном проекте продемонстрированы следующие современные инженерные подходы:

*   **Надежность и отказоустойчивость:**
    *   **Идемпотентность:** `POST`-запросы защищены от дубликатов с помощью заголовка `Idempotency-Key` и атомарной логики на уровне фильтра и базы данных.
    *   **Оптимистичные блокировки:** Использование `@Version` для предотвращения конфликтов при одновременном обновлении данных (паттерн "Lost Updates").
    *   **Механизм повторных попыток (Retry):** Автоматические ретраи с экспоненциальной выдержкой (Exponential Backoff) для обработки `OptimisticLockingFailureException` с помощью Spring Retry.
*   **Архитектура и дизайн:**
    *   **Многомодульный проект Maven:** Для изоляции слоев и обеспечения переиспользуемости кода.
    *   **Сегрегация API:** Разделение API на публичный (`/api`) и внутренний (`/internal/api`) с различными правилами авторизации.
    *   **Событийная модель статусов:** Статусы транзакций хранятся как неизменяемая история событий (паттерн Event Sourcing), что обеспечивает полный аудиторский след.
*   **Инфраструктура и DevOps:**
    *   **Контейнеризация:** Приложение поставляется в виде Docker-образа.
    *   **Управление схемой БД:** Миграции базы данных управляются с помощью инструмента Flyway.
    *   **CI/CD:** Настроен конвейер на базе GitHub Actions для автоматической сборки, тестирования и публикации мульти-архитектурных Docker-образов в GitHub Container Registry.
    *   **API Gateway:** Продемонстрирована готовность к интеграции с Kong для централизованного управления доступом.
*   **Наблюдаемость (Observability):**
    *   **Структурированное логирование:** Логи генерируются в формате JSON с помощью `logstash-logback-encoder` для упрощения их сбора и анализа.
    *   **Распределенная трассировка:** Интеграция с Micrometer Tracing для автоматической генерации `traceId` и `spanId`, что обеспечивает готовность к подключению к системам мониторинга, таким как Zipkin или Jaeger.
*   **Комплексное тестирование:**
    *   Проект покрыт различными видами тестов: юнит-тестами (Mockito), интеграционными тестами для слоя персистентности (Testcontainers с PostgreSQL) и API-тестами для веб-слоя (`MockMvc`).

---

## 3. Сборка и запуск

### 3.1. Требования к окружению

*   Git
*   JDK 21+
*   Apache Maven 3.8+
*   Docker и Docker Compose

### 3.2. Сборка проекта

Для сборки всех модулей, запуска тестов и создания Docker-образа выполните следующую команду в корневой директории проекта:

```bash
mvn clean install
```

Эта команда также установит артефакты public-api и starter в ваш локальный Maven-репозиторий.

### 3.3. Запуск сервиса
Данный сервис не предназначен для автономного запуска. Он должен быть запущен как часть общей системы, описанной в файле docker-compose.yml основного проекта развертывания.
Для локальной разработки или изолированного тестирования можно запустить приложение из IDE, используя класс TransactionServiceApplication в модуле app. Для этого потребуется запущенный экземпляр PostgreSQL и корректная настройка подключения в файле app/src/main/resources/application.yml.

## 4. Документация API
API сервиса задокументировано с использованием спецификации OpenAPI 3. После запуска приложения, интерактивная документация Swagger UI доступна по адресу:
   
http://<хост>:<порт>/swagger-ui.html

Спецификация OpenAPI в формате JSON доступна по адресу:

http://<хост>:<порт>/v3/api-docs